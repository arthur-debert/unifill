#!/usr/bin/env bash

# Exit immediately if a command exits with a non-zero status.
set -e

# Check if PYTHON_ROOT is set
if [[ -z "${PYTHON_ROOT}" ]]; then
  echo "Error: PYTHON_ROOT environment variable is not set."
  echo "Please run 'direnv allow' in the project root directory."
  exit 1
fi

# Change to the Python project directory
cd "${PYTHON_ROOT}"

# Install dependencies
echo "Installing dependencies..."
poetry install

# Run the tests
echo "Running tests..."
poetry run python -m pytest "$@"

# Print success message
echo "Tests completed successfully!"
