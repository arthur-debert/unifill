#!/usr/bin/env bash

# start-test-nvim - Start a Neovim instance configured for testing the unifill project
# This script creates a temporary init.lua file and starts Neovim with it

set -e

# Get the project root directory
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# Create necessary directories
TMP_DIR="$PROJECT_ROOT/tmp"
mkdir -p "$TMP_DIR"
mkdir -p "$TMP_DIR/logs"

# Use the externalized init.lua file
INIT_LUA="$PROJECT_ROOT/tmp/init.lua"

# Ensure we have a dataset
if [ ! -f "$PROJECT_ROOT/data/unicode.every-day.lua.gz" ]; then
  echo "Generating dataset..."
  "$PROJECT_ROOT/bin/gen-datasets" --force --unicode-blocks "Basic Latin"
fi

# Start Neovim with the external init.lua
echo "Starting Neovim with test configuration..."
echo "Press <Space>fu to open the unifill Unicode picker"
echo "Press <Space>f to access Telescope"
echo "Using FZF native extension for faster searches"
nvim -u "$INIT_LUA"