#!/usr/bin/env bash
#
# validate_lua - Validates Lua file syntax without executing the code
#
# This script checks if a Lua file has valid syntax by using the Lua compiler
# in parse-only mode. It returns 0 if the syntax is valid, and non-zero otherwise.
#
# Usage: validate_lua <file_path>

# Check if a file path was provided
if [[ $# -lt 1 ]]; then
  echo "Error: No file path provided"
  echo "Usage: $(basename "$0") <file_path>"
  exit 1
fi

FILE_PATH="${1}"

# Check if the file exists
if [[ ! -f "${FILE_PATH}" ]]; then
  echo "Error: File not found: ${FILE_PATH}"
  exit 1
fi

# Use luac to check syntax without executing the code
# -p option means "parse only"
if luac -p "${FILE_PATH}" 2>/dev/null; then
  echo "✓ Lua syntax is valid: ${FILE_PATH}"
  exit 0
else
  echo "✗ Lua syntax error in ${FILE_PATH}:"
  luac -p "${FILE_PATH}" 2>&1
  exit 1
fi